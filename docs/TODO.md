# kilar 実装計画

## 🎯 プロジェクト概要
ポートプロセス管理CLIツール「kilar」の実装計画。
開発者がよく遭遇する「ポートが既に使用されている」問題を簡単に解決するツール。

## 📋 実装タスクリスト

### Phase 1: 基盤構築 🏗️

#### 1.1 プロジェクト構造の設定
- [ ] CLIアプリケーション構造の作成
  - [ ] `src/main.rs` - エントリーポイント
  - [ ] `src/cli.rs` - CLIコマンド定義
  - [ ] `src/lib.rs` - ライブラリのルート
- [ ] モジュール構成の設計
  - [ ] `src/commands/` - コマンド実装
  - [ ] `src/port/` - ポート管理機能
  - [ ] `src/process/` - プロセス管理機能
  - [ ] `src/utils/` - ユーティリティ関数
  - [ ] `src/error.rs` - エラー型定義

#### 1.2 CLI基本実装
- [ ] Clapを使用したCLI構造の実装
  - [ ] メインコマンド構造
  - [ ] サブコマンド定義（check, kill, list）
  - [ ] グローバルオプション（--verbose, --quiet, --json）
  - [ ] ヘルプメッセージのカスタマイズ
- [ ] エラーハンドリングの基盤
  - [ ] カスタムエラー型の定義
  - [ ] Result型を使用したエラー伝播
  - [ ] ユーザーフレンドリーなエラーメッセージ

### Phase 2: コア機能実装 💡

#### 2.1 ポート情報取得機能
- [ ] プラットフォーム別の実装
  - [ ] macOS/Linux: `lsof` コマンドのラッパー
  - [ ] Windows: `netstat` コマンドのラッパー（基本サポート）
- [ ] ポート情報のパース
  - [ ] コマンド出力のパース処理
  - [ ] ポート情報構造体の定義
  - [ ] エラーケースの処理

#### 2.2 `check` コマンド実装
- [ ] ポート使用状況の確認機能
  - [ ] 指定ポートの検索
  - [ ] プロセス情報の取得（PID、名前、コマンド）
  - [ ] プロトコル情報（TCP/UDP）の取得
- [ ] 出力フォーマット
  - [ ] 通常出力（colored出力）
  - [ ] JSON出力オプション
  - [ ] Quiet/Verboseモード

#### 2.3 `kill` コマンド実装
- [ ] プロセス終了機能
  - [ ] ポートからPIDの特定
  - [ ] プロセスの停止処理
  - [ ] 権限チェックとエラーハンドリング
- [ ] 対話的確認
  - [ ] dialoguerを使用した確認プロンプト
  - [ ] --forceオプションでスキップ
  - [ ] 複数プロセスの選択機能

#### 2.4 `list` コマンド実装
- [ ] ポート一覧表示機能
  - [ ] すべての使用中ポートの取得
  - [ ] ポート範囲フィルタリング（--ports）
  - [ ] プロセス名フィルタリング（--filter）
- [ ] ソート機能
  - [ ] ポート番号順
  - [ ] PID順
  - [ ] プロセス名順
- [ ] 表形式の出力
  - [ ] テーブル表示
  - [ ] カラー対応
  - [ ] JSON出力サポート

### Phase 3: ユーザビリティ向上 ✨

#### 3.1 エラーメッセージの改善
- [ ] わかりやすいエラーメッセージ
  - [ ] ポートが使用されていない場合
  - [ ] 権限不足の場合（sudo提案）
  - [ ] 無効なポート番号
  - [ ] コマンドが見つからない場合

#### 3.2 出力フォーマットの最適化
- [ ] カラー出力の実装
  - [ ] 成功メッセージ（緑）
  - [ ] エラーメッセージ（赤）
  - [ ] 警告メッセージ（黄）
  - [ ] 情報表示（青）
- [ ] 表示フォーマットのカスタマイズ
  - [ ] コンパクト表示
  - [ ] 詳細表示
  - [ ] JSON出力

#### 3.3 パフォーマンス最適化
- [ ] 非同期処理の実装（Tokio）
  - [ ] コマンド実行の非同期化
  - [ ] 並列処理の最適化
- [ ] キャッシング戦略
  - [ ] ポート情報のキャッシング（必要に応じて）

### Phase 4: テストとドキュメント 📚

#### 4.1 テスト実装
- [ ] 単体テスト
  - [ ] 各モジュールのユニットテスト
  - [ ] パース処理のテスト
  - [ ] エラーケースのテスト
- [ ] 統合テスト
  - [ ] コマンド実行テスト
  - [ ] エンドツーエンドテスト
- [ ] モックテスト
  - [ ] システムコマンドのモック
  - [ ] プラットフォーム別テスト

#### 4.2 ドキュメント作成
- [ ] README.md
  - [ ] インストール方法
  - [ ] 使用方法
  - [ ] コマンド例
- [ ] API ドキュメント
  - [ ] rustdocコメント
  - [ ] 使用例の追加
- [ ] CONTRIBUTING.md
  - [ ] 開発環境のセットアップ
  - [ ] コーディング規約
  - [ ] プルリクエストガイドライン

### Phase 5: 配布とリリース 🚀

#### 5.1 ビルド設定
- [ ] リリースビルドの最適化
  - [ ] バイナリサイズの最小化
  - [ ] 実行速度の最適化
  - [ ] ストリップ設定
- [ ] クロスコンパイル設定
  - [ ] macOS (x86_64, aarch64)
  - [ ] Linux (x86_64, aarch64)
  - [ ] Windows (x86_64)

#### 5.2 配布準備
- [ ] GitHub Releasesの設定
  - [ ] リリースワークフロー
  - [ ] 自動ビルド設定
  - [ ] リリースノート自動生成
- [ ] Cargo.tomlの最終調整
  - [ ] メタデータの完成
  - [ ] 依存関係の最適化
- [ ] crates.io への公開準備
  - [ ] ライセンス確認
  - [ ] ドキュメント確認
  - [ ] バージョニング戦略

### Phase 6: 将来の拡張（オプション）🔮

#### 6.1 設定ファイル機能
- [ ] 設定ファイルのサポート
  - [ ] TOML形式の設定ファイル
  - [ ] デフォルト設定
  - [ ] カスタムエイリアス

#### 6.2 高度な機能
- [ ] ポート使用履歴の記録
- [ ] プロセスグループ管理
- [ ] 自動リトライ機能
- [ ] WebUIダッシュボード（将来）

## 🛠️ 技術スタック

- **言語**: Rust (Edition 2021)
- **主要クレート**:
  - `clap` (v4.5): CLI引数パーサー
  - `tokio` (v1.40): 非同期ランタイム
  - `serde` / `serde_json`: シリアライゼーション
  - `colored` (v2.1): カラー出力
  - `dialoguer` (v0.11): 対話的プロンプト
  - `anyhow` (v1.0): エラーハンドリング

## 📊 進捗トラッキング

- Phase 1: 基盤構築 [ ] 0%
- Phase 2: コア機能実装 [ ] 0%
- Phase 3: ユーザビリティ向上 [ ] 0%
- Phase 4: テストとドキュメント [ ] 0%
- Phase 5: 配布とリリース [ ] 0%
- Phase 6: 将来の拡張 [ ] 0%

## 📝 メモ

- プラットフォーム依存の処理は抽象化層を設ける
- エラーメッセージは日本語/英語の両方をサポート（将来的に）
- セキュリティを考慮し、適切な権限チェックを実装
- ユーザーエクスペリエンスを重視した設計

## 🎯 次のステップ

1. **Phase 1.1** から開始：プロジェクト構造の設定
2. 各モジュールのスケルトン作成
3. CLIの基本構造を実装
4. 単純な`check`コマンドから実装開始

---

最終更新: 2025-08-21